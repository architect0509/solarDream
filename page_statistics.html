<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./web_css.css">
</head>
<body>
    <!--  ì—¬ê¸°ë¶€í„° Headerì…ë‹ˆë‹¤! -->
    <div id="header">
        <a href="page_introduce.html" id="header_logo"></a>
    </div>
    <div id="sub_header">
        <a href="page_introduce.html" class="a_text">í˜ì´ì§€ ì†Œê°œ</a>
        <a href="" class="a_text" id="selected">í˜„í™© ë³´ê¸°</a>
        <a href="page_ranking.html" class="a_text">íƒœì–‘ê´‘ ì§€ì—­ë³„ ìˆœìœ„</a>
        <a href="https://naver.me/x8lsXYcL" class="a_text" style="padding: 0;" target="_blank">
            <img src="./image/profile.jpg" alt="" style="height: 30px; width: auto; border-radius: 50%;">
        </a>
    </div>
    <!--  ì—¬ê¸°ê¹Œì§€ Headerì…ë‹ˆë‹¤! -->

    
    <div id="infoBox">
        <h3  style="color: rgb(135, 135, 135); margin: 0;" id="title_date">ì˜¤ëŠ˜ ë‚ ì§œ</h3>
        <h1 style="color: rgb(42, 42, 42); margin: 0;" id="title_location">ë‹¹ì‹ ì˜ ì§€ì—­</h1>
        <div id="setting_info">
            <select name="region" id="select_box" onchange="ChangeRegion()">
                <option value="" disabled selected hidden>ì§€ì—­ ì„ íƒí•˜ê¸°</option>
                <script>
                    const regions = ["ê°•ì›ë„", "ê²½ê¸°ë„", "ê²½ìƒë‚¨ë„", "ê²½ìƒë¶ë„", "ê´‘ì£¼ì‹œ", "ëŒ€êµ¬ì‹œ", "ëŒ€ì „ì‹œ", "ë¶€ì‚°ì‹œ", 
                    "ì„œìš¸ì‹œ", "ì„¸ì¢…ì‹œ", "ìš¸ì‚°ì‹œ", "ì¸ì²œì‹œ", "ì „ë¼ë‚¨ë„", "ì „ë¼ë¶ë„", "ì œì£¼ë„", "ì¶©ì²­ë‚¨ë„", "ì¶©ì²­ë¶ë„"];
                    for (let i=0; i<regions.length; i++){
                        document.getElementById("select_box").innerHTML += `<option value="${regions[i]}">${regions[i]}</option>`;
                    };
                </script>
            </select>
            <input type="text" id="date_input" placeholder="YYYYMMDD">
            <button id="setting_fast_input" onclick="fast_input()">ë¹ ë¥¸ ì…ë ¥</button>
            <button id="setting_confirm" onclick="ChangeInfo()">í™•ì¸</button>
        </div>
        <div style="display: inline-block;">
            <div>
                <p id="resultIn_1"></p>
                <p id="amgo_text"></p>
                <div id="Feeling_MWH"> <!--ë©”ê°€ì™€íŠ¸ì‹œ ì²´ê° ë¦¬ìŠ¤íŠ¸-->
                    <!-- <div id="Felling_contents">
                        <p id="resultIn_1">ì•ˆë…•</p>
                    </div> -->
                </div>
                <img src="./image/sleeping.png" alt="" id="character_img" hidden="true">
                <h2 style="color: rgb(68, 68, 68);" id="There_is_no_data" hidden="true">í•´ë‹¹ ë‚ ì§œì˜ ë°ì´í„°ê°€ ì—†ì–´ìš”!</h2>
            </div>
        </div>
    </div>
    <div style="height: 45px;"></div>


    <script>
        function fast_input(){
            //í˜„ì¬ ë‚ ì§œ ë¶ˆëŸ¬ì˜¤ê¸°
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0'); // padStartëŠ” ë‘ ìë¦¬ ìˆ«ìë¥¼ ë§Œë“¤ê¸° ìœ„í•œ ë©”ì†Œë“œ )
            const day = String(today.getDate()).padStart(2, '0');        // .padStart(Stringì˜ ê¸¸ì´, ê¸¸ì´ë¥¼ ë§ì¶”ê¸° ìœ„í•´ ì±„ìš¸ ë¬¸ì)
            const now = year+month+day;
            document.getElementById("date_input").value = now; 
            document.getElementById("title_date").innerText = `${year}ë…„ ${month}ì›” ${day}ì¼`;      
        }
        
        function getSolarInfo(){
            const xhr = new XMLHttpRequest();
            key = "gYZh35zWbTLzN6GbrKJYcSlwQaSfnHrnisfzNf75asMzx9DaeRv8lTCExmvNrbpl%2Bfa%2FzA3HwLNnHjwTpKZyhw%3D%3D";
            pageNumber = 1;
            numOfRows = 17;
            date = document.getElementById("date_input").value;
            xhr.open("GET", `https://apis.data.go.kr/B552115/PvAmountByLocHr/getPvAmountByLocHr?serviceKey=${key}&pageNo=${pageNumber}&numOfRows=${numOfRows}&dataType=json&tradeYmd=${date}`)
            xhr.send();
            xhr.onreadystatechange = function(){
                //ì„œë²„ ì‘ë‹µ ì™„ë£Œ
                if(xhr.readyState !== XMLHttpRequest.DONE) return;
                if(xhr.status === 200){
                    //console.log(xhr.responseText);
                    let xhrJ = JSON.parse(xhr.responseText);    // JSON(ë¬¸ìì—´)ì„ ê°ì²´ë¡œ ë³€í™˜ -> ê°’ì— ì ‘ê·¼ ì‹œ í•„ìš”
                    let regionNm = 0;
                    let selectRegion = document.getElementById("select_box").value;
                    
                    if (xhrJ.response.body.items.item[0]==undefined) {             // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë°ì´í„°ê°€ ì—†ì–´ìš”! í™”ë©´ ë§Œë“¤ê¸°
                        document.getElementById("There_is_no_data").hidden = false;
                        document.getElementById("character_img").hidden = false;
                            document.getElementById("resultIn_1").innerText = "";
                        document.getElementById("infoBox").style.height = 500+"px";
                    }else{
                        for (let i=0; i<regions.length; i++){
                            if (xhrJ.response.body.items.item[i].regionNm === selectRegion) {
                                console.log(xhrJ.response.body.items.item[i].regionNm);
                                document.getElementById("title_location").innerText = selectRegion;
                                regionNm = i;
                                break;
                            }
                        }
                        if (xhrJ.response.body.items.item[regionNm].regionNm != selectRegion){
                            alert("í•´ë‹¹ ì§€ì—­ì˜ ë°œì „ëŸ‰ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.");
                            return;
                        }else{
                            document.getElementById("infoBox").style.height = 700+"px";
    
                            let amgo = xhrJ.response.body.items.item[regionNm].amgo;
                            document.getElementById("resultIn_1").innerText = "ìš°ë¦¬ ì§€ì—­ì˜ í•˜ë£¨ ë°œì „ëŸ‰ì€...";
                            document.getElementById("amgo_text").innerText = `${amgo} MWh`;
    
                            createElement(`ğŸ— ì „ìë ˆì¸ì§€ë¥¼ ${Math.round(amgo/0.01)}ì‹œê°„ ëŒë¦´ ìˆ˜ ìˆëŠ” ì „ë ¥ëŸ‰ì´ì—ìš”.`);
                            createElement(`ğŸ’¡ LED ì „êµ¬ë¡œ ${Math.round(amgo/0.0876)}ì‹œê°„ ë™ì•ˆ ë¶ˆì„ ì¼¤ ìˆ˜ ìˆëŠ” ì „ë ¥ëŸ‰ì´ì—ìš”.`);
                            
                            //document.getElementById("inn_content").innerText = xhr.responseText;
                        }
                    }
                } else {
                    console.log("ì—ëŸ¬ ë°œìƒ: " + xhr.status);
                }
            }
        }
        function createElement(content){
            let newElem = document.createElement("div");
            newElem.id = "Feeling_MWH";
            newElem.innerHTML = `<div id="Felling_contents">
                                    <p>${content}</p>
                                </div>`;
            document.getElementById("Feeling_MWH").appendChild(newElem);
        }

        function ChangeInfo() {
            const selectBox = document.getElementById("select_box");
            const selectedValue = selectBox.value;

            // ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì¼ ë•Œì˜ í™”ë©´
            document.getElementById("There_is_no_data").hidden = true;
            document.getElementById("character_img").hidden = true;

            document.getElementById("infoBox").style.height = 300+"px";

            document.getElementById("resultIn_1").innerText = "ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì´ì—ìš”...";
            document.getElementById("amgo_text").innerText = "";
            document.getElementById("Feeling_MWH").innerHTML = "";

            if (selectedValue) {
                if (document.getElementById("date_input").value != "") {
                    getSolarInfo();

                } else{ alert("ë‚ ì§œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."); }
            } else { alert("ì§€ì—­ì„ ì„ íƒí•´ì£¼ì„¸ìš”."); }
        }

        function ChangeRegion() {
            const selectBox = document.getElementById("select_box");

            document.getElementById("title_location").innerText = selectBox.value;
        }
    </script>


    <!--  ì—¬ê¸°ë¶€í„° Footerì…ë‹ˆë‹¤! -->
    <div id="bottom">
        <img src="./image/logo_dark.png" alt="" id="bottom_logo">
        <p id="bottom_text">
            ë°ì´í„° ì¶œì²˜: <a href="https://www.data.go.kr/data/15103243/openapi.do" target="_blank">ê³µê³µë°ì´í„°í¬í„¸_í•œêµ­ì „ë ¥ê±°ë˜ì†Œ</a><br>
            ê°œë°œì: ë¶€ì²œëŒ€í•™êµ ì»´í“¨í„°ì†Œí”„íŠ¸ì›¨ì–´í•™ê³¼ 2433013 í™ì¬í˜„ _ 2í•™ë…„ ì›¹í´ë¼ì´ì–¸íŠ¸ í”„ë¡œê·¸ë˜ë°<br>
            varsion: 1.0.0
        </p>
    </div>
     <!--  ì—¬ê¸°ê¹Œì§€ Footerì…ë‹ˆë‹¤! -->
    
</body>
</html>
